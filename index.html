<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZ FOR CSS ASPIRANTS 25 APRIL 2025 - SYED ASGHAR ALI SHAH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font globally */
        body {
            font-family: 'Inter', sans-serif;
            /* Disable text selection */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */
            /* Prevent image dragging */
            -webkit-user-drag: none;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Style for radio buttons */
        input[type="radio"] {
            accent-color: #3b82f6; /* Blue-500 */
        }
        /* Add some spacing between questions */
        .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb; /* Gray-200 */
        }
        .question-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        /* Styling for options */
        .option-label {
            display: block;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border: 1px solid #d1d5db; /* Gray-300 */
            border-radius: 0.375rem; /* Rounded-md */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .option-label:hover {
            background-color: #f3f4f6; /* Gray-100 */
        }
        .option-label input[type="radio"] {
            margin-right: 0.75rem;
        }
        /* Hide sections initially */
        #quiz-section, #results-section {
            display: none;
        }
        /* Style for the timer */
        #timer {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #dc2626; /* Red-600 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">

    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center space-x-4 mb-3 md:mb-0">
                <img src="https://media-hosting.imagekit.io//0b9a4af30efb4482/WhatsApp%20Image%202025-02-28%20at%203.15.19%20AM.jpeg?Expires=1835349432&Key-Pair-Id=K2ZIVPTIP2VGHC&Signature=jwJPYv24ynvpiPUADnh2kUGPUbG6OBggLpvXOj6~ZZAgts7lamWPTIZKmuIaQ5WaRUAG568acIjSbBE1XrKsIPvCHTXKNA-XF6ppaM~tacD0TMTVoTFd7-EsYFsesMaR~5AK7n5qr33hIwKVawluJ1rkdqmuQokM~T~W~O~6Yo-qXgYGio2IvfBsu1u~wEi1Cnk-5pAOavMUb9IfeY7E4FNwGBgiLCiHugKJD9sAY8As7S0szpehWI8WIQzMzNUFN4wvtPAamSART1m5nlUT4uLcvwdr-C1pk4kJN6I0itWzZEbZN04ANZexY3dpBhUDO0~UvQBCps64LPKIQBRYtA__"
                     alt="SYED ASGHAR ALI SHAH"
                     class="h-16 w-16 rounded-full border-2 border-white object-cover shadow-lg"
                     onerror="this.onerror=null; this.src='https://placehold.co/64x64/e2e8f0/64748b?text=SAAS';">
                <div>
                    <h2 class="text-lg font-semibold">SYED ASGHAR ALI SHAH</h2>
                    <p class="text-sm text-indigo-200">CSS Aspirant</p>
                </div>
            </div>
            <h1 class="text-xl md:text-2xl font-bold text-center md:text-right">ADVANCED ENGLISH QUIZ <br class="md:hidden"> (25 APRIL 2025)</h1>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">

        <section id="name-entry-section" class="bg-white p-6 md:p-8 rounded-lg shadow-lg max-w-lg mx-auto text-center">
            <h2 class="text-2xl font-semibold mb-6 text-indigo-700">Welcome to the Quiz</h2>
            <p class="mb-6 text-gray-600">Please enter your full name to begin the assessment.</p>
            <div class="mb-6">
                <label for="student-name" class="block text-sm font-medium text-gray-700 mb-2 text-left">Full Name:</label>
                <input type="text" id="student-name" name="student-name" placeholder="e.g., Syed Asghar Ali Shah" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
            </div>
            <button id="start-quiz-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                Start Quiz
            </button>
            <p id="name-error" class="text-red-500 text-sm mt-3" style="display: none;">Please enter your name.</p>
        </section>

        <section id="quiz-section" class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 class="text-2xl font-semibold text-indigo-700">Quiz Questions</h2>
                <div class="text-right">
                    <p class="text-sm text-gray-500">Time Remaining:</p>
                    <div id="timer" class="font-bold text-xl text-red-600">25:00</div>
                </div>
            </div>

            <form id="quiz-form">
                <div id="questions-container"></div>

                <button type="submit" id="submit-quiz-btn" class="mt-8 w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                    Submit Quiz
                </button>
            </form>
        </section>

        <section id="results-section" class="bg-white p-6 md:p-8 rounded-lg shadow-lg max-w-2xl mx-auto text-center">
            <h2 class="text-3xl font-bold mb-6 text-indigo-700">Quiz Results</h2>
            <div class="space-y-4 text-lg text-left border border-gray-200 p-6 rounded-md bg-gray-50">
                <p><strong class="font-semibold text-gray-700">Name:</strong> <span id="result-name" class="text-indigo-600"></span></p>
                <p><strong class="font-semibold text-gray-700">Questions Attempted:</strong> <span id="result-attempted" class="text-indigo-600"></span> / 50</p>
                <p><strong class="font-semibold text-gray-700">Correct Answers:</strong> <span id="result-score" class="text-green-600 font-bold"></span> / 50</p>
                <p><strong class="font-semibold text-gray-700">Percentage:</strong> <span id="result-percentage" class="text-blue-600 font-bold"></span>%</p>
                <p><strong class="font-semibold text-gray-700">Time Taken:</strong> <span id="result-time" class="text-indigo-600"></span></p>
            </div>
            <p id="submission-status" class="mt-6 text-gray-600">Your results have been recorded. Thank you for participating!</p> </section>

        <form id="results-formspree" action="https://formspree.io/f/xwpvddea" method="POST" style="display: none;">
            <input type="text" name="student_name" id="formspree-name">
            <input type="number" name="attempted_questions" id="formspree-attempted">
            <input type="number" name="score" id="formspree-score">
            <input type="text" name="percentage" id="formspree-percentage">
            <input type="text" name="time_taken" id="formspree-time">
            <input type="hidden" name="_subject" value="New Quiz Submission - CSS Aspirant">
        </form>

    </main>

    <footer class="bg-gray-800 text-gray-300 mt-12 py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-2">Need assistance or have questions?</p>
            <p class="mb-4 font-semibold text-lg text-white">Contact: 03265762698</p>
            <p class="text-sm">&copy; 2025 SYED ASGHAR ALI SHAH - CSS Preparation Resources. All rights reserved.</p>
            <p class="text-xs mt-2 text-gray-500">Designed for dedicated CSS Aspirants.</p>
        </div>
    </footer>

    <script>
        // --- Quiz Data ---
        const quizQuestions = [
            // Grammar: Parts of Speech Identification (Based on Grammar Analysis PDF)
            {
                question: "In the sentence 'India, however, continues to insist that the incident was orchestrated...', what part of speech is 'however'?",
                options: { a: "Adjective", b: "Conjunction (Coordinating)", c: "Adverb (Conjunctive/Transitional)", d: "Preposition" },
                correct: "c"
            },
            {
                question: "Identify the function of 'holding' in the phrase 'holding the Indus Waters Treaty (IWT) in abeyance'.",
                options: { a: "Main Verb", b: "Gerund (acting as a noun/subject)", c: "Present Participle (acting as an adjective)", d: "Infinitive" },
                correct: "b" // It's the subject of the implied clause 'Holding the IWT... is a violation'.
            },
            {
                question: "What type of noun is 'faith' in the phrase 'in good faith'?",
                options: { a: "Proper Noun", b: "Concrete Noun", c: "Collective Noun", d: "Abstract Noun" },
                correct: "d"
            },
            {
                question: "In '...a step that is destructive to its vital national interests.', what is the function of the clause 'that is destructive to its vital national interests'?",
                options: { a: "Noun Clause", b: "Adverb Clause", c: "Independent Clause", d: "Adjective (Relative) Clause" },
                correct: "d" // It modifies 'step'.
            },
            {
                question: "Which word in the following sentence is a preposition? 'The operation of a treaty may be suspended in conformity with its provisions.'",
                options: { a: "operation", b: "suspended", c: "conformity", d: "with" },
                correct: "d"
            },
             // Grammar: Verb Tense/Form/Voice
            {
                question: "What is the tense and voice of the verb phrase 'has been made' in '...no shred of evidence... has been made public...'?",
                options: { a: "Present Perfect Active", b: "Past Perfect Passive", c: "Present Perfect Passive", d: "Simple Past Passive" },
                correct: "c"
            },
            {
                question: "The sentence 'Pakistan immediately distanced itself...' uses which verb voice?",
                options: { a: "Passive Voice", b: "Active Voice", c: "Subjunctive Mood", d: "Imperative Mood" },
                correct: "b"
            },
            {
                question: "Which modal verb in the text expresses obligation or necessity?",
                options: { a: "may (in 'may be suspended')", b: "will (in 'will be treated')", c: "must (in 'must be performed')", d: "can (not explicitly used this way in text)" },
                correct: "c"
            },
             // Grammar: Prepositions & Complex Sentences
            {
                question: "Choose the most appropriate preposition: 'Pakistan is heavily dependent ___ the Indus river system.'",
                options: { a: "with", b: "on", c: "at", d: "from" },
                correct: "b"
            },
            {
                question: "Identify the type of sentence: 'Under Chapter VII of the UN Charter, the UN Security Council is authorised to examine cases which may be a threat to international peace and to take appropriate action.'",
                options: { a: "Simple", b: "Compound", c: "Complex", d: "Compound-Complex" },
                correct: "c" // Independent clause + dependent adjective clause.
            },
            // Vocabulary: Synonyms (Based on Idioms/Synonyms PDF)
            {
                question: "Which word is a synonym for 'abeyance' as used in 'held in abeyance'?",
                options: { a: "Activation", b: "Continuation", c: "Suspension", d: "Conclusion" },
                correct: "c"
            },
            {
                question: "What is a synonym for 'escalatory'?",
                options: { a: "Decreasing", b: "Stabilizing", c: "Increasing / Intensifying", d: "Calming" },
                correct: "c"
            },
            {
                question: "The word 'unequivocally' means:",
                options: { a: "Ambiguously", b: "Hesitantly", c: "Clearly / Without doubt", d: "Quietly" },
                correct: "c"
            },
            {
                question: "Which word best replaces 'landmark' in 'landmark accord'?",
                options: { a: "Insignificant", b: "Temporary", c: "Historic / Significant", d: "Secret" },
                correct: "c"
            },
            {
                question: "A synonym for 'hurdle' is:",
                options: { a: "Advantage", b: "Assistance", c: "Obstacle", d: "Path" },
                correct: "c"
            },
             // Vocabulary: Antonyms (Based on Idioms/Synonyms PDF)
            {
                question: "What is an antonym for 'provocations'?",
                options: { a: "Incitements", b: "Aggressions", c: "Appeasements / Conciliations", d: "Challenges" },
                correct: "c"
            },
            {
                question: "Choose the antonym for 'hostility' (related to 'Act of War').",
                options: { a: "Aggression", b: "Conflict", c: "Belligerence", d: "Peace / Amity" },
                correct: "d"
            },
            {
                question: "An antonym for 'fiscally unsustainable' would be:",
                options: { a: "Bankrupt", b: "Unprofitable", c: "Financially Viable / Profitable", d: "Expensive" },
                correct: "c"
            },
            {
                question: "What is the opposite of 'neglected'?",
                options: { a: "Ignored", b: "Overlooked", c: "Attended to / Cared for", d: "Forgotten" },
                correct: "c"
            },
            {
                question: "The antonym of 'stagnation' (related to 'poor growth') is:",
                options: { a: "Decline", b: "Recession", c: "Inactivity", d: "Expansion / Prosperity" },
                correct: "d"
            },
            // Idioms (Based on Idioms/Synonyms PDF)
            {
                question: "What does the idiom 'jumped the gun' mean?",
                options: { a: "Acted patiently", b: "Fired a weapon", c: "Acted too quickly or prematurely", d: "Won a race" },
                correct: "c"
            },
            {
                question: "If 'the ball is in India's court', it means:",
                options: { a: "India has lost the game", b: "It is India's turn to act or respond", c: "India is hosting a sports event", d: "Pakistan is responsible" },
                correct: "b"
            },
            {
                question: "'Sabre-rattling' refers to:",
                options: { a: "Polishing weapons", b: "Peace negotiations", c: "Making threats of war or military action", d: "A type of sword fight" },
                correct: "c"
            },
            {
                question: "The phrase 'at the mercy of' implies:",
                options: { a: "Being in control", b: "Being kind to someone", c: "Being completely subject to someone's power", d: "Showing forgiveness" },
                correct: "c"
            },
            {
                question: "What does 'wake up and smell the coffee' urge someone to do?",
                options: { a: "Have breakfast", b: "Become alert to reality / Face the facts", c: "Go back to sleep", d: "Buy coffee" },
                correct: "b"
            },
             // Sentence Rearrangement (Based on sentences from PDFs)
            {
                question: "Arrange the following parts into a coherent sentence: (1) must be performed / (2) treaties / (3) in good faith / (4) lays down that",
                options: { a: "4, 2, 1, 3", b: "2, 4, 1, 3", c: "4, 1, 3, 2", d: "2, 1, 3, 4" },
                correct: "a" // "lays down that treaties must be performed in good faith" (From Vienna Convention reference)
            },
            {
                question: "Arrange the following: (1) is heavily dependent / (2) on the Indus river system / (3) Pakistan / (4) for its agricultural sector",
                options: { a: "3, 1, 2, 4", b: "1, 3, 2, 4", c: "3, 2, 1, 4", d: "4, 1, 3, 2" },
                correct: "a" // "Pakistan is heavily dependent on the Indus river system for its agricultural sector."
            },
            {
                question: "Arrange the following: (1) of lack of civic sense / (2) are all examples / (3) vandalism, hoarding, intolerance / (4) in society",
                options: { a: "1, 2, 3, 4", b: "3, 2, 1, 4", c: "3, 1, 2, 4", d: "2, 1, 4, 3" },
                correct: "b" // "vandalism, hoarding, intolerance are all examples of lack of civic sense in society."
            },
            {
                question: "Arrange the following: (1) the high and mighty / (2) decided to focus / (3) on graduate programs / (4) ignoring basic education needs",
                // This requires slight adaptation for flow, implying the ignoring part.
                options: { a: "1, 2, 3, 4", b: "2, 1, 3, 4", c: "1, 4, 2, 3", d: "4, 1, 2, 3" },
                correct: "a" // "The high and mighty decided to focus on graduate programs, ignoring basic education needs." (Implied context from PDF)
            },
            {
                question: "Arrange the following: (1) a competent tribunal / (2) to be decided by / (3) it is a question of law / (4) as a matter of first impression",
                options: { a: "3, 2, 1, 4", b: "1, 2, 3, 4", c: "3, 4, 2, 1", d: "2, 1, 4, 3" },
                correct: "a" // "it is a question of law to be decided by a competent tribunal as a matter of first impression."
            },
             // Conceptual/Tricky Grammar & Vocabulary
            {
                question: "In 'Pakistan immediately distanced itself...', the word 'itself' is a:",
                options: { a: "Possessive Pronoun", b: "Demonstrative Pronoun", c: "Reflexive Pronoun", d: "Relative Pronoun" },
                correct: "c"
            },
            {
                question: "The phrase 'mala fide intent' suggests an action taken with:",
                options: { a: "Good intentions", b: "Neutral purpose", c: "Bad faith or dishonest purpose", d: "Legal justification" },
                correct: "c"
            },
            {
                question: "What is the primary function of the passive voice in sentences like 'The incident was orchestrated...' within the context of the provided text?",
                options: { a: "To make the sentence shorter", b: "To emphasize the actor (who did it)", c: "To sound more subjective", d: "To emphasize the action or recipient, often sounding more formal or objective" },
                correct: "d"
            },
            {
                question: "Which of these terms from the text specifically refers to the *repeal or abolition* of an agreement?",
                options: { a: "Suspension", b: "Abrogation", c: "Violation", d: "Arbitration" },
                correct: "b"
            },
            {
                question: "The term 'casus belli' refers to:",
                options: { a: "A peace treaty", b: "A diplomatic negotiation", c: "An act justifying war", d: "A legal document" },
                correct: "c"
            },
             // More challenging questions
            {
                question: "Identify the grammatical mood used in 'It is hoped that the UN secretary general's office will play a role...'",
                options: { a: "Indicative", b: "Imperative", c: "Subjunctive", d: "Interrogative" },
                correct: "c" // Expresses a hope/desire, fitting the subjunctive use.
            },
            {
                question: "What kind of phrase is 'pursuant to Article 40'?",
                options: { a: "Noun Phrase", b: "Verb Phrase", c: "Adjectival Phrase", d: "Prepositional Phrase (acting adverbially)" },
                correct: "d" // 'Pursuant to' acts as a compound preposition here.
            },
            {
                question: "The idiom 'close ranks' means:",
                options: { a: "To stand farther apart", b: "To argue fiercely", c: "To unite and support each other", d: "To surrender" },
                correct: "c"
            },
            {
                question: "What is the difference between 'suspension' and 'termination' of a treaty, based on the text's context?",
                options: { a: "They mean the same thing.", b: "Suspension is permanent; termination is temporary.", c: "Suspension is temporary; termination is permanent ending.", d: "Suspension requires agreement; termination does not." },
                correct: "c"
            },
            {
                question: "Which word implies a state of being 'shockingly bad' or 'outstandingly bad'?",
                options: { a: "Flimsy", b: "Provocative", c: "Egregious", d: "Unilateral" },
                correct: "c"
            },
             // Final set of diverse questions
            {
                question: "Identify the part of speech of 'only' in '...suspended... only when it is breached...'",
                options: { a: "Adjective", b: "Noun", c: "Adverb", d: "Conjunction" },
                correct: "c" // Modifies the condition 'when it is breached'.
            },
            {
                question: "What does 'civic sense' primarily relate to, according to the text?",
                options: { a: "Political knowledge", b: "Personal hygiene", c: "Social ethics and responsibility towards society", d: "Driving skills" },
                correct: "c"
            },
            {
                question: "Choose the best synonym for 'dispossessed' in the context of 'peasantry is being dispossessed'.",
                options: { a: "Empowered", b: "Enriched", c: "Deprived of land or property", d: "Organized" },
                correct: "c"
            },
            {
                question: "The phrase 'fever pitch' indicates a state of:",
                options: { a: "Illness", b: "Calmness", c: "Great excitement or intensity", d: "Low temperature" },
                correct: "c"
            },
            {
                question: "Rearrange: (1) is bound to aggravate / (2) disruption of water supplies / (3) existing water scarcity / (4) further",
                // Needs slight adjustment for perfect grammar flow if 'further' modifies aggravate.
                options: { a: "2, 1, 3, 4", b: "3, 1, 2, 4", c: "2, 4, 1, 3", d: "1, 3, 2, 4" },
                correct: "a" // "disruption of water supplies is bound to aggravate existing water scarcity further."
            },
            {
                question: "What type of verb is 'become' in '...sources of instability... have become threats...'?",
                options: { a: "Action Verb", b: "Helping Verb", c: "Linking Verb", d: "Modal Verb" },
                correct: "c"
            },
            {
                question: "An antonym for 'callous' (as in 'must not be a callous person') is:",
                options: { a: "Insensitive", b: "Hardened", c: "Compassionate / Sympathetic", d: "Cruel" },
                correct: "c"
            },
            {
                question: "The idiom 'reaping the results' implies:",
                options: { a: "Planting seeds", b: "Avoiding consequences", c: "Experiencing the consequences (often negative) of past actions", d: "Celebrating success" },
                correct: "c"
            },
            {
                question: "What does 'intolerance' mean in the context of lacking civic sense?",
                options: { a: "Physical weakness", b: "Unwillingness to accept different views or behaviors", c: "Patience", d: "Agreement" },
                correct: "b"
            },
            {
                question: "Identify the function of 'to maintain' in '...take appropriate action to maintain international peace...'",
                options: { a: "Noun (Gerund)", b: "Adjective (Participle)", c: "Adverb (Infinitive of Purpose)", d: "Main Verb" },
                correct: "c" // Explains the purpose of the action.
            }
        ];


        // --- DOM Elements ---
        const nameEntrySection = document.getElementById('name-entry-section');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');
        const nameInput = document.getElementById('student-name');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const nameError = document.getElementById('name-error');
        const questionsContainer = document.getElementById('questions-container');
        const quizForm = document.getElementById('quiz-form');
        const submitQuizBtn = document.getElementById('submit-quiz-btn');
        const timerDisplay = document.getElementById('timer');

        const resultName = document.getElementById('result-name');
        const resultAttempted = document.getElementById('result-attempted');
        const resultScore = document.getElementById('result-score');
        const resultPercentage = document.getElementById('result-percentage');
        const resultTime = document.getElementById('result-time');
        const submissionStatus = document.getElementById('submission-status'); // Get the status element

        const formspreeForm = document.getElementById('results-formspree');
        const formspreeName = document.getElementById('formspree-name');
        const formspreeAttempted = document.getElementById('formspree-attempted');
        const formspreeScore = document.getElementById('formspree-score');
        const formspreePercentage = document.getElementById('formspree-percentage');
        const formspreeTime = document.getElementById('formspree-time');

        // --- Quiz State ---
        let timerInterval;
        let timeLeft = 25 * 60; // 25 minutes in seconds
        let startTime;
        let studentName = '';
        let quizSubmitted = false; // Flag to prevent multiple submissions

        // --- Functions ---

        // Function to shuffle options (Fisher-Yates Shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }


        // Function to display questions
        function displayQuestions() {
            questionsContainer.innerHTML = ''; // Clear previous questions
            quizQuestions.forEach((q, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');

                const questionText = document.createElement('p');
                questionText.classList.add('text-lg', 'font-semibold', 'mb-4');
                questionText.textContent = `${index + 1}. ${q.question}`;
                questionBlock.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('space-y-2');

                // Get options as an array of [key, value] pairs and shuffle them
                let optionsArray = Object.entries(q.options);
                optionsArray = shuffleArray(optionsArray); // Shuffle the options order

                optionsArray.forEach(([key, value]) => {
                    const label = document.createElement('label');
                    label.classList.add('option-label', 'flex', 'items-center'); // Use flex for alignment

                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = `question-${index}`;
                    radio.value = key;
                    radio.required = true; // Make selection required

                    label.appendChild(radio);
                    label.appendChild(document.createTextNode(` ${value}`)); // Add space before text
                    optionsDiv.appendChild(label);
                });

                questionBlock.appendChild(optionsDiv);
                questionsContainer.appendChild(questionBlock);
            });
        }

        // Function to start the timer
        function startTimer() {
            startTime = Date.now();
            timerDisplay.textContent = formatTime(timeLeft);

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = formatTime(timeLeft);

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz(true); // Auto-submit
                }
            }, 1000);
        }

        // Function to format time (MM:SS)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            // Handle cases where time might go slightly negative if submission takes time
            if (minutes < 0 || remainingSeconds < 0) return "00:00";
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        // Function to calculate results
        function calculateResults() {
            let score = 0;
            let attempted = 0;
            const formData = new FormData(quizForm); // Use the actual quiz form

            quizQuestions.forEach((q, index) => {
                const userAnswer = formData.get(`question-${index}`);
                if (userAnswer) {
                    attempted++;
                    if (userAnswer === q.correct) {
                        score++;
                    }
                }
            });

            const endTime = Date.now();
            // Calculate elapsed time correctly, even if auto-submitted
            const timeElapsedSeconds = timeLeft <= 0 ? 25 * 60 : Math.floor((endTime - startTime) / 1000);
            const timeTakenFormatted = formatTime(timeElapsedSeconds);

            return { score, attempted, timeTakenFormatted, timeElapsedSeconds };
        }

        // Function to display results and handle submission
        function displayResults(results) {
            // Display results on the page
            resultName.textContent = studentName;
            resultAttempted.textContent = results.attempted;
            resultScore.textContent = results.score;
            const percentage = quizQuestions.length > 0 ? ((results.score / quizQuestions.length) * 100).toFixed(1) : 0;
            resultPercentage.textContent = percentage;
            resultTime.textContent = results.timeTakenFormatted;

            // Hide quiz, show results
            quizSection.style.display = 'none';
            resultsSection.style.display = 'block';

            // Populate hidden Formspree form fields
            formspreeName.value = studentName;
            formspreeAttempted.value = results.attempted;
            formspreeScore.value = results.score;
            formspreePercentage.value = percentage;
            formspreeTime.value = results.timeTakenFormatted;

            // Update submission status message
            submissionStatus.textContent = "Submitting results...";
            submissionStatus.classList.remove('text-red-500', 'text-green-600');
            submissionStatus.classList.add('text-yellow-600');


            // Submit the hidden form using Fetch API
            const formSpreeData = new FormData(formspreeForm);

            fetch(formspreeForm.action, {
                method: 'POST',
                body: formSpreeData,
                headers: {
                    'Accept': 'application/json' // Important for Formspree AJAX
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log('Form submitted successfully to Formspree.');
                    submissionStatus.textContent = "Results submitted successfully. Thank you for participating!";
                    submissionStatus.classList.remove('text-yellow-600', 'text-red-500');
                    submissionStatus.classList.add('text-green-600');
                } else {
                    // Try to parse the error response from Formspree
                    response.json().then(data => {
                        console.error('Formspree submission failed:', data);
                        const errorMessage = data.errors ? data.errors.map(e => e.message).join(', ') : 'Unknown error.';
                        submissionStatus.textContent = `Error submitting results: ${errorMessage} Please contact the administrator.`;
                        submissionStatus.classList.remove('text-yellow-600', 'text-green-600');
                        submissionStatus.classList.add('text-red-500');

                    }).catch(() => {
                        // Fallback if parsing JSON fails
                        console.error('Formspree submission failed. Status:', response.status);
                        submissionStatus.textContent = `Error submitting results (Status: ${response.status}). Please contact the administrator.`;
                        submissionStatus.classList.remove('text-yellow-600', 'text-green-600');
                        submissionStatus.classList.add('text-red-500');
                    });
                }
            })
            .catch(error => {
                console.error('Network error submitting form to Formspree:', error);
                submissionStatus.textContent = `Network error submitting results: ${error.message}. Please check your connection and contact the administrator.`;
                submissionStatus.classList.remove('text-yellow-600', 'text-green-600');
                submissionStatus.classList.add('text-red-500');
            });
        }


        // Function to handle quiz submission (triggered by button or timer)
        function submitQuiz(isAutoSubmit = false) {
            if (quizSubmitted) return; // Prevent multiple submissions
            quizSubmitted = true;

            clearInterval(timerInterval); // Stop the timer

            // Check if all questions are answered (optional, but good practice)
            const formData = new FormData(quizForm);
            let allAnswered = true;
            for (let i = 0; i < quizQuestions.length; i++) {
                if (!formData.has(`question-${i}`)) {
                    allAnswered = false;
                    break;
                }
            }

            // Only show alert if submitting manually and not all answered
            if (!isAutoSubmit && !allAnswered) {
                 // Using a simple confirm, replace with a styled modal if preferred
                if (!confirm("You haven't answered all questions. Are you sure you want to submit?")) {
                    quizSubmitted = false; // Allow resubmission if cancelled
                    startTimer(); // Restart timer if they cancel (adjust timeLeft if needed)
                    return; // Stop the submission process
                }
            }


            const results = calculateResults();
            displayResults(results); // This now handles displaying results AND submitting the form

            if (isAutoSubmit) {
                console.log("Quiz auto-submitted due to time out.");
                // Add a message indicating auto-submission
                const autoSubmitMsg = document.createElement('p');
                autoSubmitMsg.textContent = "Time ran out! Your quiz was automatically submitted.";
                autoSubmitMsg.classList.add('text-center', 'text-red-600', 'font-semibold', 'mt-4', 'mb-2'); // Added margin bottom
                // Insert before the main status message
                resultsSection.insertBefore(autoSubmitMsg, submissionStatus);
            }
        }

        // --- Event Listeners ---

        // Start Quiz Button
        startQuizBtn.addEventListener('click', () => {
            studentName = nameInput.value.trim();
            if (studentName) {
                nameError.style.display = 'none';
                nameEntrySection.style.display = 'none';
                quizSection.style.display = 'block';
                displayQuestions();
                startTimer();
            } else {
                nameError.style.display = 'block';
            }
        });

        // Quiz Form Submission Button
        quizForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Prevent default form submission which would navigate away
            submitQuiz();
        });

        // Disable Right Click / Context Menu
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // Disable common inspect shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === "F12" || e.keyCode === 123 ||
                (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J" || e.key === "C")) ||
                (e.ctrlKey && e.key === "U")) {
                 e.preventDefault();
            }
        });

    </script>

</body>
</html>
